{"summary": "phylogenies of rapidly evolving pathogens can be difficult to resolve because of the small number of substitutions that accumulate in the short times since divergence. the number of observed substitutions between sequences can be too low to yield well-resolved. insertions and deletions (indels) are a promising category of molecular sequence information that is ignored in phylogenetic reconstruction. researchers commonly remove gaps from molecular sequences alignments by coding them as missing data or by throwing out columns that contain gaps. indels can help to resolve phylogenies in situations where the number of nucleotide substitutions is inadequate. a statistical method of incorporating indel information into phylogeny estimation. this method uses a joint reconstruction framework that simultaneously infers the alignment, tree, and insertion/deletion rates. this approach takes into account uncertainty resulting from the myriad of near-optimal alignments. we introduce a new indel model to remedy a shortcoming of the Redelings and Suchard (RS05) model. the reversible RS05 model does not make use of branch length information in the indel process. in order to increase biological realism, we describe an extended indel model that is able to incorporate branch length information. the HIV data set consists of about 600 nucleotides from the env gene from 27 within-host strains. to see if indel information improves phylogenetic resolution we compare the number of bi-partitions supported under the joint model and the traditional sequential approach. time-dependence enables us to place indels preferentially on longer branches of the tree, producing a realistic description of the evolutionary process. a novel MCMC transition kernel to increase topology mixing so that we can estimate phylogenies and alignments containing increasingly more taxa. substitution likelihood P(Y|A,, T, ) and the priors P(, T) and P() occur in traditional Bayesian models that fix the alignment. the alignment prior P(A|, T, ) and the prior on indel process parameters P() are novel in the joint model, allowing for estimation and a natural way to handle uncertainty in A. indels that start or end within a codon may force incorrect alignments at the nucleotide level, causing up to two misaligned residues per indel. this may result in significant bias when the total number of substitutions is small. a pairwise alignment A can be decomposed into a set of pairwise alignments A(b) along each branch b of the topology. this is possible because of the inclusion of Felsenstein wildcard sequences at the internal nodes of. we propose a new pairwise alignment prior that maintains a fixed sequence length distribution even when the indel probability varies from branch to branch. each sequence consists of a series of unbreakable fragments, as in the TKF2 model. the fragment lengths are geometrically distributed with continuation probability. the model is a fragment based model because the direct transition probability from (+/+) to (+/+ is and not 0. The pair-HMM represents an improper distribution because the probabilities of outgoing edges of the central silent state do not sum to 1. if we attempt to set ( 1 ) \u2032 ( t ) = 1 e t b, ( 4 ) then the probability '(t) can become greater than 1. we move the factor of (1 - ) into the time scale, such that \u2032 ( t ) = 1 e t b 1. length 0. This allows us to specify a different value of (t) in the pair-HMM on each branch of the tree without affecting. this implies that the posterior distribution of the joint model is proper because the distribution conditions on the observed leaf sequence lengths. the alignment of the subset of sequences corresponding to taxa in the pruned subtree (Figure 2, blue) must remain consistent because their phylogeny remains unchanged. however, the alignment of the other sequences (Figure 2, green) must remain consistent because their phylogeny remains unchanged. integration over the set of all alignments is not practical, even if we constrain the alignment of leaf sequences to be constant. therefore, we fix parts of the alignment and collapse only the remaining portions. this constraint, which we call C3(A,, O) requires an O(L3) dynamic programming algorithm for integration and resampling. triplet substitution models can prohibit stop codons, make use of codon frequencies instead of nucleotide frequencies and differentiate between synonymous and non-synonymous substitutions. the latter is biologically realistic, but the latter may not be. triplet frequencies ( t ) for each triplet composed of nucleotides i, j and k are set to the product i (s ) j ( s ) k ( s ) of the individual nucleotide frequencies. for an allowable substitution ijk ijl, we note that the rate Q i j k, i j l ( t ) according to the triplet model does not match the rate Q k we use HKY as the singlet model in our comparison because the HKY 3 model is identical to the M0 codon model with = 1, stop codons included, and independent nucleotide frequencies. both data sets come from related genes, but they differ in their sequence length. lentiviruses contain a single-stranded RNA genome that reverse transcribes into DNA by upon infection. lentiviruses contain a single-stranded RNA genome that reverse transcribes into DNA by upon infection. lentiviruses are extremely error-prone, giving lentiviruses high mutation rates. model # sites #/6 with PP Estimates var. inf. > 0.90 > 0.95 > 0.99 ln ln - Indel Clustal W 10 6 1 1 1 2.3(1.6,4.9) - - Muscle 12 7 4 3 0 2.2(1.5,4.3) - - MAP 11 6 3 1 1 2.4(1.6,5.2) - - - - MAP 11 6 3 1 1 2.4(1.6,5.2) - for a prior on ln, we assume a Double-Exponential distribution with median ln 2 and standard deviation 1 2. On the expected indel length we assume an Exponential distribution with mean. on the branch lengths we assume an Exponential distribution with mean, and on we assume an Exponential distribution with mean 0.04. at high posterior probabilities indels become relatively more important. at posterior probability > 0.99 the traditional sequential model supports only one branch. the two green branches are supported only when indel information is used. a collection of 27 partial env gene sequences sampled serially at three time points from patient 1 reported by Shankarappa et al. each sequence name consists of a unique identifying number prefixed by the number of weeks after infection that the sequence was sampled. the posterior distribution of has median 0.996 and a 95% BCI of (0.834,1.20) this changes little when f is free. the estimated interval is quite close to the prior 95% BCI of (0.84,1.16) so we conclude that these data possess little information about. the HKY model does not support the clade (10,12,18) as well as the singlet model. fixing f = 1 2 instead of the traditional value of 1 produces a decrease in marginal likelihood of 2 log units for the HKY model. the resulting model is supported over the f = 1 model by 7 log units of marginal likelihood. of 24.1 log units between models, we calculate the posterior distribution of parsimony tree lengths. the posterior median tree length is 104 substitutions with a 95% BCI of (103,106) for the singlet model. the posterior mean number of indels is 11.0 and the BCI is (11,11) the posterior mean number of indels beginning 0, 1, or 2 nucleotides from the beginning of a codon is 2.6, 5.8, and 2.6 respectively. the displaced A residues join A residues from strains 10, 12, and 18 (green) which were previously the only A residues in that column. under both models, the MAP alignment estimates display 8 gaps. the alignment of internal sequences indicates that these gaps arose from 5 indel events on branches partitioning clades (20,23), (21,24), (16,17), (19), and (22) thus, the gaps in sequences 19 and 22 arose independently of the gap in (16,17) the HKY 3 model predicts a mean indel length of 1.1 triplets and 3.2 nucleotides. but the HKY 3 model predicts a mean indel length of 1.6 nucleotides. this may be because a geometric distribution on the number of nucleotides in a gap does not fit the data. the number of branches supported only under the joint model is 2, 2, and 2. the joint model supports the clades (16,17) and (21,24) over the traditional model at all three levels of PP. the traditional model supports the clade at a PP of 0.980 compared to 0.887 with indel information. the new MCMC transition kernel introduced in the sub-section Sampling improves the computational efficiency of topology estimation. the transition kernel improves the convergence properties of the Markov chain substantially, so that fewer initial samples must be discarded as \"burn-in\" we estimate the equilibrium topology distribution with 200 topologies sampled at widely spaced intervals from a long-running MCMC analysis. this distribution is not sensitive to the starting point of the Markov chain, and does not change when the new transition kernel is enabled. the median time to convergence is 2112 iterations with an average of 1976.9. the figure depicts every 10th tree for the first 2000 iterations. for the NNI+SPR chain the figure depicts every 2nd tree for the first 400 iterations. time-dependent indel process enables us to place indels preferentially on longer branches of the tree. 2N -3) is a vector of branch lengths along the edges in, and vectors. Felsenstein wildcard sequences of random lengths at the internal nodes of. we scale branch lengths in terms of expected number of substitutions. codon-based models group the three nucleotides in a codon into a single letter. codon-based models are preferred over amino acid-based models because they do not discard synonymous substitutions. codon-based models can also improve model efficiency over nucleotide-based models. the assumption further allows us to avoid fragment based pair-HMMs that tend to separate indels by the average indel length. the assumption further allows us to avoid fragment based pair-HMMs that tend to separate indels by the average indel length. the pairwise alignment distribution induces a sequence length distribution on each sequence in the pair it emits. this implies that there is no preferred direction of evolution between the two sequences. this implies that the sequence length distribution for the ancestral and descendant sequences are equal. a pair-HMM represents an improper distribution because the probabilities of outgoing edges of the central silent state do not sum to 1. the pair-HMM represents an improper distribution because the probabilities of outgoing edges of the central silent state do not sum to 1. in our previous model, we measure the occurrence probability of indels on a per-residue basis. in the fragment-based model, '(t) becomes the probability of an indel occurring between two residues is (1 - )'(t) however, if we attempt to set ( 1 ) \u2032 ( t ) = 1 e t b, ( 4 ) then the probability '(t) can become greater than 1. the pairwise alignment distribution is a uniform distribution on the number of fragments, with each fragment being a match (+/+), insertion (-/+) or deletion (+/-) with probabilities 1 - 2(t), (t) and (t) respectively, and with exit measure (1 - (t) this allows us to specify a different value of (t) in the pair-HMM on each branch of the tree without affecting. phylogeny relating sequences at pruned nodes (blue) and phylogeny relating sequences at the remaining nodes (green) do not change. alignments within each of these sequence subsets can remain unchanged from (a) to (b) transition kernel to choose between the collapsed points (*,, T,, )C and (*, ', T', )C. to satisfy detailed balance, the set C must be constructed so that it contains at least the current alignment A. full conditions under which this procedure satisfies detailed balance are described in the Appendix. the constraint set C2(A,, OP) contains an alignment that is consistent with'as well as, making C2(A,, OP) a useful constraint set for collapsed sampling. triplet models coalesce three adjacent nucleotide letters into a single triplet letter. the fraction specifies the relative importance of unequal conservation (f = 0) and unequal replacement (f = 1) in creating the equilibrium frequency distribution. each allowable substitution involves only one nucleotide substitution from nucleotide i to nucleotide j. the rates do not match because the rate of change from k l in the triplet model depends on the frequencies of the other nucleotides in the triplet. this is not true in the singlet model, the likelihoods under each model cannot match unless all nucleotide frequencies are equal. HKY 3 model is identical to the M0 codon model with = 1, stop codons included. each molecular sequence Yi is a collection of letters of length |Yi|. we characterize the stochastic model that describes how the sequences in Y diverged from a common ancestor. substitution likelihood P(Y|A,, T, ) and the priors P(A|, T, ) and P() occur in traditional Bayesian models that fix the alignment. however, the alignment prior P(A|, T, ) and the prior on indel process parameters P() are novel in the joint model. codon-based models also affect the indel process by forbidding frameshift mutations and also indels that begin or end within a codon. the latter constraint may force incorrect alignments at the nucleotide level, causing up to two misaligned residues per indel. pairwise alignments can be decomposed into a set of pairwise alignments A(b) along each branch b of the topology. this is possible because of the inclusion of Felsenstein wildcard sequences at the internal nodes of. we propose a new pairwise alignment prior that maintains a fixed sequence length distribution even when the indel probability varies from branch to branch. the fragment lengths are geometrically distributed with continuation probability and minimum length 1. each ancestral fragment survives in the descendent with probability '(t) = (t)/(1 - (t)) pair-HMM represents an improper distribution because the probabilities of outgoing edges of the central silent state do not sum to 1. the model is a fragment based model because the direct transition probability from (+/+) to (+/+ is and not 0. if we attempt to set ( 1 ) \u2032 ( t ) = 1 e t b, ( 4 ) then the probability '(t) can become greater than 1. we move the factor of (1 - ) into the time scale, such that \u2032 ( t ) = 1 e t b 1. substitution model to model the substitution process that specifies P(Y|A,, T, ), we assume that substitutions in each column of A occur independently and follow a continuous-time Markov chain (CTMC) process. this makes the position of the root unidentifiable and so we use unrooted trees throughout this paper. the number of observed substitutions is low, requiring researchers to fix to a previously estimated value. codon-based models also affect the indel process by forbidding frameshift mutations. the latter constraint may force incorrect alignments at the nucleotide level, causing up to two misaligned residues per indel. pairwise alignments can be decomposed into a set of pairwise alignments A(b) along each branch b of the topology. this decomposition is possible because of the inclusion of Felsenstein wildcard sequences at the internal nodes of. we propose a new pairwise alignment prior that maintains a fixed sequence length distribution even when the indel probability varies from branch to branch. each sequence consists of a series of unbreakable fragments, as in the TKF2 model. the fragment lengths are geometrically distributed with continuation probability and minimum length 1. the model is a fragment based model because the direct transition probability from (+/+) to (+/+ is and not 0. The pair-HMM represents an improper distribution because the probabilities of outgoing edges of the central silent state do not sum to 1. the distribution t naturally gives rise to two models. in the first model, denoted as \"fragments+T\", we set ( b) = t b making the probability of an indel roughly proportional to branch length tb. the sequence length distribution induced by t is independent of t. a new MCMC transition kernel improves mixing between topologies and alignments. the new kernel uses the SPR operator (Figure 2) to propose new trees. this resulted in long convergence times and inefficient mixing. the alignment of the subset of sequences corresponding to taxa in the pruned subtree (Figure 2, blue) must remain consistent because their phylogeny remains unchanged. however, the alignment of the other sequences (Figure 2, green) must remain consistent because the phylogeny of that subset remains unchanged. integration over the set of all alignments is not practical even if we constrain the alignment of leaf sequences to be constant. therefore, we fix parts of the alignment and collapse only the remaining portions. this constraint, which we call C3(A,, O) requires an O(L3) dynamic programming algorithm for integration and resampling. triplet substitution models can prohibit stop codons, make use of codon frequencies instead of nucleotide frequencies and differentiate between synonymous and non-synonymous substitutions. we construct a triplet substitution model that generates the same likelihood as a singlet substitution model given the same alignment. triplet frequencies ( t ) for each triplet composed of nucleotides i, j and k are set to the product i (s ) j ( s ) k ( s ) of the individual nucleotide frequencies. for an allowable substitution ijk ijl, we note that the rate Q i j k, i j l ( t ) according to the triplet model does not match the rate Q k the frequency of neighboring nucleotides no longer affect the rate of change from k l, as Q i j k, i j l ( t) = S i j k, i j l ( t) i j l ( t ) can be independent of the frequencies of i and j. lentiviruses contain a single-stranded RNA genome that reverse transcribes into DNA by upon infection. lentiviruses contain a single-stranded RNA genome that reverse transcribes into DNA by upon infection. lentiviruses are extremely error-prone, giving lentiviruses high mutation rates. model # sites #/6 with PP Estimates var. inf. > 0.90 > 0.95 > 0.99 ln ln - Indel Clustal W 10 6 1 1 1 2.3(1.6,4.9) - - Muscle 12 7 4 3 0 2.2(1.5,4.3) - - MAP 11 6 3 1 1 2.4(1.6,5.2) - - - - MAP 11 6 3 1 1 2.4(1.6,5.2) - for a prior on ln, we assume a Double-Exponential distribution with median ln 2 and standard deviation 1 2. On the expected indel length we assume an Exponential distribution with mean, and on we assume an Exponential distribution with mean 0.04. indels become relatively more important because they are rarer than substitutions. at posterior probability > 0.99 the traditional sequential model supports only one branch. the two green branches are supported only when indel information is used. the Clustal W alignment requires at least 5 indel events. the high frequency of the CAA triplet is partially responsible for the level of alignment uncertainty. the sequences span HIV genome reference sites 7023\u20137637. distribution of has median 0.996 and a 95% BCI of (0.834,1.20) this changes little when f is free. the estimated interval is quite close to the prior 95% BCI of (0.84,1.16) so we conclude that these data possess little information about. Allowing to vary does not yield much benefit. the resulting model is supported over the f = 1 model by 7 log units of marginal likelihood. the posterior median of f is 0.43, close to the value of 1 2 that is used to compare the HKY and HKY 3 models. the posterior median tree length is 104 substitutions with a 95% BCI of (103,106) for the singlet model. we first calculate the posterior distribution of the number of indels under the singlet model. the posterior mean number of indels beginning 0, 1, or 2 nucleotides from the beginning of a codon is 2.6, 5.8, and 2.6 respectively. the displaced A residues join A residues from strains 10, 12, and 18 (green) which were previously the only A residues in that column. under both models, the MAP alignment estimates display 8 gaps. the alignment of internal sequences indicates that these gaps arose from 5 indel events on branches partitioning clades (20,23), (21,24), (16,17), (19), and (22) thus, the gaps in sequences 19 and 22 arose independently of the gap in (16,17) the HKY 3 model predicts a mean indel length of 1.1 triplets and 3.2 nucleotides. but the HKY 3 model predicts a mean indel length of 1.6 nucleotides. this may be because a geometric distribution on the number of triplets in a gap does not fit the data. the joint model supports the clades (16,17) and (21,24) over the traditional model at all three levels of PP. the traditional model supports the clade (19,21,24,25) at a PP of 0.980 compared to 0.887 with indel information. lentiviruses contain a single-stranded RNA genome that reverse transcribes into DNA by upon infection. lentiviruses contain a single-stranded RNA genome that reverse transcribes into DNA by upon infection. the DNA then inserts into the host genome before expression. model # sites #/6 with PP Estimates var. inf. > 0.90 > 0.95 > 0.99 ln ln - Indel Clustal W 10 6 1 1 1 1 2.3(1.6,4.9) - - MAP 11 6 3 1 1 1 2.4(1.6,5.2) - - - MAP 11 6 3 1 1 1 2.4(1.6,5.2) - - - + Indel Clustal W 10 6 3+1 3+1 2 distribution with median ln 2 and standard deviation 1 4. On ln, we assume an Exponential distribution with mean. on the branch lengths we assume an Exponential distribution with mean. on the branch lengths we assume an Exponential distribution with mean. ignoring alignment ambiguity can lead to exaggerated support for branches and bias towards the guide tree. ignoring alignment ambiguity can lead to exaggerated support for branches. the high frequency of the CAA triplet is partially responsible for the level of alignment uncertainty. we consider a collection of 27 partial env gene sequences sampled serially at three time points from patient 1 reported by Shankarappa et al [4] each sequence name consists of a unique identifying number prefixed by the number of weeks after infection that the sequence was sampled. the estimated interval is quite close to the prior 95% BCI of (0.84,1.16) so we conclude that these data possess little information about. Allowing to vary does not yield much benefit, and henceforth consider only = 1. Table 2. Comparison of alignment and substitution models. fixing f = 1 2 instead of the traditional value of 1 produces a decrease in marginal likelihood of 2 log units for the HKY model. the resulting model is supported over the f = 1 model by 7 log units of marginal likelihood. the posterior median of f is 0.43, close to the value of 1 2 used to compare the HKY and HKY 3 models. s with a 95% BCI of (103,106) for the singlet model increases to 109 substitutions with a 95% BCI of (108,110) for the triplet model. the posterior mean number of indels beginning 0, 1, or 2 nucleotides from the beginning of a codon is 11.0. the 95% BCI for the number of indels beginning inside a codon is (6,11) the MAP alignment estimates display 8 gaps. the alignment of internal sequences indicates that these gaps arose from 5 indel events on branches partitioning clades (20,23), (21,24), (16,17), (19) and (22) thus, the gaps in sequences 19 and 22 arose independently of the gap in (16,17) even though they have the same length and position. the HKY 3 model predicts a mean indel length of 1.1 triplets and 3.2 nucleotides. but the HKY 3 model predicts a mean indel length of 1.6 nucleotides. this may be because a geometric distribution on the number of triplets in a gap does not fit the data as well as a geometric distribution on the number of triplets in a gap. the joint model supports the clades (16,17) and (21,24) over the traditional model at all three levels of PP. the traditional model also supports the clade (10,12,15,16,18,19,21,24,25) at PP > 0.9 that has support 0.5 when indel information is included. we use the same prior distributions on,,, and T as in Example 1. the posterior distribution of has median 0.996 and a 95% BCI of (0.834,1.20) this changes little when f is free. for the first two models we fix independent nucleotide frequencies. the HKY model has a higher marginal probability than the HKY 3 triplet model. despite these increases in marginal likelihood, the M0 model does not support the clade (10,12,18) singlet versus triplet models compared marginal likelihoods and posterior tree lengths. the log marginal likelihood is -1555.7 0.3 for the singlet model and -1579.8 0.3 for the triplet model. the posterior median tree length is 104 substitutions with a 95% BCI of (103,106) for the singlet model. triplet alignments may shift indels and cause misaligned residues. in the triplet alignment, two G residues (blue) and four A residues (red) are forced into a different column to avoid breaking the alignment-wide reading frame. displaced A residues join A residues from strains 10, 12, and 18 (green) which were previously the only A residues in that column. triplet models have discernible effects on estimates of the indel parameters and, but little effect on the substitution parameters. the HKY 3 model is the indel rate per triplet, whereas the singlet model is the indel rate per nucleotide. the HKY 3 model supports 8, 7 and 4 internal branches at PP levels > 0.90, > 0.95, and > 0.99. the MAP topology is also insensitive to the chosen fixed alignment. the joint model supports the clades (16,17) and (21,24) over the traditional model at all three levels of PP. indel information conflicts with one branch in the substitution-only tree. the conflicting branch is ruled out by the support of 2 shared indels for the clade. branches colored green are supported only when indel information is incorporated. the expectation of d(1, ) does not converge to 0 as the Markov chain approaches stationarity; rather the expectation approaches the average distance between two trees sampled from the equilibrium topology distribution. without the new transition kernel, the median time to convergence is 2112 iterations with an average of 1976.9. we project the tree samples from two typical chains into the plane using multidimensional scaling based on their RF distances. points represent 200 topologies sampled from a Markov chains with the alignment-aware SPR transition kernel disabled (red; NNI-only) or enabled (blue; NNI+SPR) or from the equilibrium distribution (green). indels when gaps overlap can lead to more accurate and informative indel characters. this high rate can lead to identical but non-homologous insertions in different taxa. repeat indels experience higher homoplasy than non-repeat indels. indel model enables indels to be shared by descent, but has some limitations. incorrect accounting for rates at which indels occur in different regions can lead to over-weighting of indel evidence. indel model makes the assumption that residues in a single sequence are never homologous. the relative weight of indels and substitutions shared by descent is specified by the relative rate estimated from the data. this offers an improvement over existing methods that force the relative weight to be set a priori. the joint estimation framework does not suffer from this sensitivity to alignment choice. f is a collapsing function, then it partitions into a set of non-overlapping subsets. we denote the set of collapsed points as f(), and note that the probability *(f(x)) of each collapsed point f(x can be naturally defined as the integral of the probabilities (y) of points y f(x) the function f that maps (A,, T, ) to (,, T,,, ) C 2 ( A,, PO ) is a collapsing function. the directed branch PO partitions the nodes of into two subsets excluding node O. MH rule for acceptance or rejection and MH satisfies detailed balance on the collapsed points. i j = j j i i f i f j = j f j j i f i f j = j j i i i f j = j j i i i j. alignments are the estimates obtained from Clustal W [37], Muscle [38], and BAli-Phy [24]. in the latter case, we fix the alignment to its Maximum A Posteriori point determined jointly. parameters and models used by BAli-Phy are described in the Results section. f is a collapsing function, then it partitions into a set of non-overlapping subsets. we denote the set of collapsed points as f(), and note that the probability *(f(x)) of each collapsed point f(x can be naturally defined as the integral of the probabilities (y) of points y f(x) the function f that maps (A,, T,, ) to (,,, PO ) is a collapsing function. set C2 contains all alignments that are consistent with A on each of the two subsets. f(x) and f(y) are either identical or non-overlapping. MH satisfies detailed balance on the collapsed points. kernel that uses collapsed sampling of alignments as a proposal distribution. we reject this new point j and move back to the original alignment and topology i with a small probability 1 - ij. distribution fi is proportional to the product of the length distributions on the internal nodes. we use the default parameters for Clustal W and Muscle. it is often impractical to analyze data sets with more than 12 taxa or sequence lengths longer than about 750 letters."}