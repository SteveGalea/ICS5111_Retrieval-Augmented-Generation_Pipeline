{"summary": "docking is widely used to predict protein-ligand complexes[1], [2] and to screen large libraries for molecules that will modulate the activity of a biological receptor. it has predicted new ligands for over 50 targets in the last five years alone[3]\u2013[57] in prospective, comparative studies with experimental high-throughput screening. several widely-used docking methods have been introduced to address these problems. the program FRED[69] exhaustively samples geometries defined by a regular latice, filters using pharmacophores, and then evaluates the remaining poses with an energy function. GLIDE SP[72] uses several levels of sampling and scoring, ending with a modified version of ChemScore with ten scoring terms[73], and GLIDE XP[74] uses eighty parameters for scoring. DOCK3.5.54 managed a relatively rapid screening of chemical libraries. the latter relied on an implementation of traditional hot-spot-based graph matching[81], [82] which focused the search for complementary ligand orientations to the protein likely to lead to favorable fits. the latter eliminated the need to build ligand conformations on the fly, especially useful when docking the same ligand to multiple proteins as the time is saved for additional screens beyond the first. graph cliques mean superpositions of sets of ligand atoms on receptor hot-spots. ligand orientation sampling grows regularly, predictably and nonstochastically. this is crucial to understanding whether our core challenges in docking are sampling or scoring. DOCK remains available as a free download, with source for all our programs. a web-based implementation for those interested in using it for ligand discovery without investing in a local installation is also available[90]. we use a single parameter to control how many orientational matches are desired. the current DOCK architecture matches only rigid rings[78]\u2013[80], allowing the rest of the molecule encoded in the flexibase hierarchy to move with respect to that rigid ring positioned in the binding site. decoys find better poses relative to the ligands. the ligands were extracted and compared to their docked poses. the mean RMSD went from 3.1 to 2.7 to 2.6 to 2.9 to 3.0. the docked DUD-E ligands of GRIK1 have a median critical contact. orientational sampling increases from 50 to 20000. 86 of 99 docked known ligands showed a decreased critical contact RMSD as orientational sampling increased. 4 poses of ZINC00013260 are shown in B through E, with increasing sampling going from left to right. in 77 of the 102 DUD-E systems, increased sampling improves enrichment. this may be judged by the area under a Receiver Operator Characteristic (ROC) curve. adjusted logAUC is the area under the ROC curve, where the x-axis is logarithmic to favor early ligand enrichment. positive numbers represent enrichment of ligands over physically-matched decoys. there were 25 targets where increased sampling had little effect on enrichment (Figures 4A and C), or even reduced it (Figures 4B and D). in cases where the effect of increased sampling on enrichment is negative, it is possible that 1) decoys are finding unrealistic poses, 2) the scoring function has not properly captured some aspect of the system, 3) some decoys may actually be ligands. the focus on screening multi-million compound libraries has motivated rapid calculations in the DOCK3.x programs. but as ambitions increasingly turn to docking across families of proteins and even the proteome, the need for further optimization remains pressing. here we investigated systematic optimization of compiler flags for the code. ligand enrichment against decoys across the DUD-E systems already achieve an adjusted logAUC of 13, or an EF1 of 11.6, at a match goal of 50 orientations. the adjusted logAUC and EF1 values improve to 14.8 and 12. if we take 500 ligand orientations as a sensible level of sampling, screening 1.5 million molecules in the lead-like available-now set in ZINC[68] would require about 2700 hours on a single core. if this remains a substantial investment, it is less than two days on a small cluster of 100 cores, and an afternoon on a cluster of 1000 cores, a size that is increasingly common. ligand conformations are often ignored owing to concerns about overweighting the term in an effectively low dielectric calculation[100]. this is the first time this has been attempted on such a large scale (over 1.4 million ligands and decoys) the MMFF94S energies from OMEGA are shown below each pose. the bottom conformation on either side is the lowest energy conformation according to either energy function. the scales at either side are the differences in energy score from the best conformation to the shown conformation. over 60 systems do better with electrostatics on, but the mean difference is 0.0 due to the more extreme differences when electrostatics off ligand builds perform better. over 60 systems do better with electrostatics on, but the mean difference is 0.0 due to the more extreme differences when electrostatics off ligand builds perform better. inset images show a phenol with the dihedral angle marked, B) is an example of off-planar aromatic hydroxyls produced by DOCK3.5.54, DOCK3.6 or in this paper as the \u201cNo Reset\u201d option, C) is the Reset Hydroxyl version. the worst difference in favor of No Reset being better was 0.24 logAUC for BRAF. the worst difference for any match goal is SAHH of 0.53 logAUC for a match goal of 500. other improvements made the docking output more extendable and widely usable. we ran each DUD-E target with 500 orientational samples through a bump limit of +10 kcal/mol, 20, 50 or no limit. the mean difference in logAUC was 0.3; only 8 DUD-E targets had a logAUC difference higher than one. the speed of the docking procedure is roughly doubled simply from using a bump limit at all. over all 102 DUD-E targets is shown. the bump limit itself does not have a large effect on the time. but using a high bump limit instead of none roughly doubles the speed of docking. the current DOCK architecture matches only rigid rings[78]\u2013[80], allowing the rest of the molecule encoded in the flexibase hierarchy to move with respect to that rigid ring positioned in the binding site. we use an adaptive system where a desired number of matches is specified, as well as a minimum, maximum and increment of the distance tolerance. 86 of the 99 docked known ligands showed a decreased critical contact RMSD as orientational sampling increased from 50 to 20000. the mean RMSD went from 3.1 to 2.7 to 2.6 to 2.9 to 3.0. 4 poses of ZINC00013260 are shown in B through E, with increasing sampling going from left to right, better DOCK scores and lower critical contact RMSD. 77 of 102 DUD-E systems, increased sampling improves enrichment. adjusted logAUC is the area under the ROC curve, where the x-axis is logarithmic to favor early ligand enrichment. positive numbers represent enrichment of ligands over physically-matched decoys. orientational sampling increased from 50 to 500 to 2000 to 5000 to 20000 poses. decoys are finding unrealistic poses, 3) some decoys may actually be ligands, or 4) a combination of these possibilities. one example is MAP kinase-activated protein kinase 2 (MAPK2) where the enrichment gets worse with more orientational sampling. compiler-level optimization and code efficiencies to increase raw speed. a second major improvement came from optimizing energy scoring grids. grids pre-compute receptor energy potential functions, such as van der Waals and Poisson-Boltzmann-derived electrostatic potentials. most docking programs[72], [75], [76], [81], [85], [95]\u2013[99] use a grid-based approach for at least initial scoring. such a stratagem may be widely applicable. a program that is suitable for large-scale library screens. if we take 500 ligand orientations as a sensible level of sampling, screening 1.5 million molecules in the lead-like available-now set in ZINC[68] would require about 2700 hours on a single core (about one ligand every 5 seconds) if this remains a substantial investment, it is less than two days on a small cluster of 100 cores, and an afternoon on a cluster of 1000 cores. ligand conformations are often ignored owing to concerns about overweighting the term in an effectively low dielectric calculation[100]. this is the first time this has been attempted on such a large scale (over 1.4 million ligands and decoys), and the first time it has been judged by docking all the resulting conformations. enrichment of ligands over decoys improved in 60% of DUD-E targets. but in the 40% of targets where enrichment diminished, it diminished further than it had increased in the 60% of the systems where it improved. the mean enrichment over DUD-E was essentially zero. over 60 systems do better with electrostatics on, but the mean difference is 0.0 due to the more extreme differences when electrostatics off ligand builds perform better. blue systems are proteases, 6 of the 15 DUD-E protease systems are in this table. the bin from 3.1 to 3.1 is shown only at left. to investigate the impact of such hydroxyl sampling on docking enrichment, 29 DUD-E targets had a substantial number of hydroxyl-bearing ligands were investigated. a match goal is SAHH of 0.53 logAUC for a match goal of 500. the molecular library had been represented in a format that sacrificed ligand topology for a highly compressed format. the docked output has lost none of the information of the original mol2 file. we ran each DUD-E target with 500 orientational samples through a bump limit of +10 kcal/mol, 20, 50 or no limit (not using the repulsive filter) Favorable energies are negative. only 8 DUD-E targets had a logAUC difference higher than one. only 26 of the possible 103 ligands had a pose identified at all. this number rose to 41, 67 and finally 102. this is the extreme case, as the other 94 targets did not show this dependence. in 23 DUD-E targets enrichment did not rise with greater orientation sampling. in almost all of the 102 targets improvements in enrichment plateaued after about 2000 orientations had been sampled. a key to exploring the variation of enrichment with sampling was a code base optimized for speed. the main purpose of DOCK 3.7 will be prospective screening of fragment[110] and lead-like[111] subsets of ZINC. most of the problems appear isolated to very large, peptide-like and drug-like ligands, not usually attempted during prospective virtual screening campaigns. ligand library generation and docking are separated in the docking pipeline presented here. the code can dock all ligands and decoys to their DUD-E targets in as few as 11 hours, but longer and more extensive tests take thousands of hours. the code can dock all ligands and decoys to their DUD-E targets in as few as 11 hours. protein-ligand electrostatics is calculated using QNIFFT[124], [125], a version of DelPhi[126]. previous methods for protonation of sidechains have been replaced with REDUCE[121] as the most adaptable program. all parts of the new protein target preparation script are written in Python. mol2db[79], [80], an implementation of the flexibase concept[78], was used to collect ligand conformations for docking. the new hierarchy format tracks the input conformations, and only docks complete input conformations. the new pipeline uses a lower RMSD cutoff in OpenEye OMEGA[83], [105] and more output conformations (2000 versus 600) than before. mol2db2 preserves atom typing and bond information according to the TRIPOS mol2 format. Molecular Docking Code for DOCK 3.7[88] is based on DOCK 3.6[84], [89], [93], [106] with extensive modifications. the code has been rewritten in FORTRAN95 with 2003 extensions. the new db2 file format is used as input to DOCK 3.7. all grids are allocated dynamically so that only the input files must be changed. each docking job completed here used less than 250 megabytes of memory. UCSF Chimera remains the preferred visualization tool to use with DOCK. this amounted to reorganizing the 3 dimensional grid of data and various access loops to maximize spatial and temporal locality. a sizable amount of execution time was discovered to be spent handling virtual memory page table exceptions. we optimized the build procedure to include only compiler optimizations known to benefit execution time as not all compiler heuristics benefit every application. some small number of ligands will not have critical contact atoms so their RMSD is undefined. for this reason, medians are reported instead of means. this avoids arbitrariness of bias induced from single protein-ligand crystal structure RMSD. CHEMGRID[122] is used to make the van der Waals grid using an AMBER forcefield[123] for the receptor. SOLVMAP[93] is used to calculate a ligand desolvation grid. QNIFFT improved performance on DUD[103] slightly as compared to preparations with DelPhi. mol2db[79], [80], an implementation of the flexibase concept[78], was written, with a new hierarchy format derived from the original flexibase concept[78]. the new hierarchy format tracks the input conformations, and only docks complete input conformations instead of ones that have been piece together from different input conformations. mol2db2 preserves atom typing and bond information according to the TRIPOS mol2 format for each ligand. future versions of ZINC[102] will contain and distribute pre-built db2 files for many purchasable ligands as well as active molecules from ChEMBL[128] Orientations of the ligand into the receptor can be generated using a single parameter of distance tolerance. a more tolerant parameter leads to more matches but always includes the matches found with a lower distance threshold. receptor spheres are heavy atom positions of atoms in the rigid component. the ability to save multiple top poses of a ligand is now implemented. UCSF Chimera remains the preferred visualization tool to use with DOCK. mol2 output files are likely usable with other molecular graphics programs. the optimization techniques generally fell within four categories. these were used with the Portland Group FORTRAN compiler as it produced the fastest compiled code[130]. despite the sophistication of the vectorizing compiler, development time was invested inspecting the assembly code of critical loops and modifying the FORTRAN code to ensure vector instruction invocation. DOCK3.7 Documentation is available at https://sites.google.com/site/dock37wiki/ under the Creative Commons Attribution-ShareAlike 3.0 Unported License. the Shoichet Lab cluster of over 800 CPUs was used for all processing. (xlsx) Supplementary Information S1 DB2 File Format (TXT) Click here for additional data file."}