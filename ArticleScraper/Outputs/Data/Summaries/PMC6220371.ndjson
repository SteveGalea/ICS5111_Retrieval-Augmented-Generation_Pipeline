{"summary": "phylogenetic estimates of divergence times of many viral lineages are too recent. phylogenetic estimates of when major simian immunodeficiency virus groups diverged are almost 100 times more recent than the estimate based on geographic isolation of their host species. most phylogenetic models try to account for these constraints using relatively simple approaches such as allowing the rate of substitution to vary across sites according to some statistical distribution (Yang 1994; Yang et al. 2000). these models of purifying selection are usually inadequate (Duch\u00eane et al. 2015a; Duch\u00eane, Di Giallonardo, and Holmes 2015b) ExpCMs and other models of purifying selection estimate branch lengths on a phylogenetic tree of influenza virus hemagglutinin (HA) this extension of branch length is mostly independent and additive with that achieved by the more conventional approach of modeling rate variation. results 2.1 Different ways substitution models account for purifying selection. the gene-wide is usually 1 (Murrell et al. 2015) and crudely represents the fact that many amino-acid substitutions are under purifying selection. a single gene-wide ignores the fact that purifying selection is heterogeneous across sites. the most common strategy to ameliorate this defect is to allow to vary among sites according to some statistical distribution. substitution models can incorporate neither, one, or both of these features. mutation-selection models account for the fact that purifying selection depends idiosyncratically on the specific amino-acid mutation at each site in the protein. mutation-selection models must specify 19 parameters defining the amino-acid preferences for each site. this corresponds to 19 L parameters for a protein of length L, or 9,500 parameters for a 500-residue protein. the number of ExpCM free parameters is similar to a non-site-specific substitution model. a substitution model transforms sequence divergence into branch length. the transformation from sequence divergence to branch length is trivial when the sequence identity is high. a simple exponential model will correctly infer the short branch length of 1 / L substitutions per site. the GY94 model predicts the same behavior for all sites, since it does not have site-specific parameters. the predicted sequence identity is higher than 1 20 = 0.05 due to redundant codon and nucleotide biases favoring certain amino acids. but biochemically improbable that it would ever become as low as 0.062. GY94+ model takes longer to reach the asymptote than GY94. but the asymptote is identical for both models. the invariance of the asymptotic sequence identity under different schemes for modeling is a fundamental feature of this type of reversible substitution model. an ExpCM but not a GY94-style model predicts that the identity will always be relatively high. simulations demonstrate how failure to model site-specific amino-acid preferences leads to branch-length underestimation. we simulated alignments of sequences along the HA phylogenetic tree. we performed 10 simulations and inferences, and gray points show each inferred branch length from each simulation. black points show the average of each branch length across simulations. the GY94 model estimated branch lengths that are 60 per cent of the true values for the longest branches. HA consists of a number of different subtypes. sequences within a subtype have >68 per cent amino-acid identity. but sequences in different subtypes have as little as 38 per cent identity. the amino-acid preferences measured for these two HAs are shown in Supplementary Figs S1 and S2. the H1 and H3 HAs have only 42 per cent amino-acid identity. the ExpCMs always fit an greater than the GY94 model. the ExpCM+ models fit all four categories to values 1. the ExpCM is the relative rate of fixation of nonsynonymous to synonymous mutations. this more realistic null model gives ExpCMs enhanced power to detect diversifying selection for amino-acid change. all ExpCMs describe evolution of HA better than the GY94 models. models that account for purifying selection via either rate variation or site-specific amino-acid preferences do not just exhibit better fit. ExpCMs use amino-acid preferences measured in deep mutational scanning of an H1 HA (Doud and Bloom 2016), an H3 HA (Lee et al. 2018), or the average of the measurements for these two HAs. the root of each tree is placed where it would fall if the tree was midpoint rooted using the branch lengths inferred by RAxML using the GTRCAT model. the ExpCM informed by the H1 data most dramatically lengthens branches near the H1 clade of the tree. the ExpCM informed by the H3 data has the largest effect on branches near the H3 clade. ExpCMs estimate longer branches, but that the effect is shaped by the set of amino-acid preferences used to inform the model. an ExpCM leads to the most profound increase in branch length leading to the sequence used in the experiment. the effect of a mutation at one site in a protein can depend on the amino-acid identities of other sites in the protein. this can lead to shifts in a protein\u2019s amino-acid preferences over evolutionary time. ExpCM stringency parameter (ExpCM stringency parameter) is a measure of congruence between natural selection and the experimental measurements. values of that are >1 indicate that natural selection prefers the same amino acids as the experiments but with greater stringency. Fig. 6 shows that the amino-acid preferences clearly become less informative about natural selection as we move away from the experimental sequence on the tree. this shift of amino-acid preferences helps explain why the ExpCM informed by the average of the H1 and H3 experiments performs best. the maximum-likelihood implementations of Tamuri, dos Reis and goldstein are designed for estimating the amino-acid preferences, not for phylogenetic inference. the model most comparable to our ExpCMs is the codon mutation-selection model implemented in PhyloBayes-MPI, which we will refer to as pbMutSel. pbMutSel models fit a pbMutSel model to the entire HA tree. we compared the results to those from analyzing the same tree with the best ExpCM. the pbMutSel model also draws from a gamma-distribution. the ExpCM amino-acid preferences are experimentally measured and then rescaled by the stringency parameter in Table 1. the pbMutSel preferences are more correlated with the re-scaled average of the H1 and H3 deep mutational scanning preferences are to each other. the phydms program implementing ExpCMs and the PhyloBayes-MPI program implementing pbMutSel models estimated similar branch lengths the 'tree average' amino-acid preferences inferred by the pbMutSel model appear to be slightly better than the experimental values. the 'tree average' preferences inferred by the pbMutSel model appear to be slightly better than the experimental values. a single gene-wide ignores the fact that purifying selection is heterogeneous across sites. the most common strategy to ameliorate this defect is to allow to vary among sites according to some statistical distribution. a GY94+ captures the fact that the rate of nonsynonymous substitution can vary across sites. mutation-selection models account for the fact that purifying selection depends idiosyncratically on the specific amino-acid mutation at each site in the protein. these models explicitly define a different set of amino-acid preferences at each site in the protein. mutation-selection models must specify 19 parameters defining the amino-acid preferences for each site. this corresponds to 19 L parameters for a protein of length L, or 9,500 parameters for a 500-residue protein. it is challenging to obtain values for these amino-acid preference parameters in a maximum-likelihood framework without overfitting the data. a substitution model transforms sequence divergence into branch length. the transformation from sequence divergence to branch length is trivial when the sequence identity is high. if there has only been one substitution, then the sequence identity will simply be ( L 1 ) / L for a gene of L sites. 0.05 due to redundant codon and nucleotide biases favoring certain amino acids. it seems biochemically improbable that it would ever become as low as 0.062. Fig. 2 shows that the GY94+ model takes longer to reach the asymptote than GY94, but that the asymptote is identical for both models. this fact holds true even if we use experimental measurements of HA\u2019s site-specific amino-acid preferences to calculate a different r value for each site. simulations demonstrate how failure to model site-specific amino-acid preferences leads to branch-length underestimation. we simulated alignments of sequences along the HA phylogenetic tree using an ExpCM parameterized by the amino-acid preferences of an H1 HA. inferred branch lengths exactly matched those used in the simulations. the GY94 model estimated branch lengths that are 60 per cent of the true values for the longest branches. there was no systematic underestimation of long branches by the ExpCM and ExpCM+ models. a subtype have >68 per cent amino-acid identity, but sequences in different subtypes have as little as 38 per cent identity. HA proteins from all subtypes have a highly conserved structure that performs a highly conserved function. we used RAxML with a nucleotide substitution model (GTRCAT) to infer a tree for 92 HA sequences drawn from 15 of the 18 subtypes. three sets of HA amino-acid preferences define three different ExpCMs. the best fit was for the ExpCM informed by the average of the H1 and H3 deep mutational scans. the best fit was for the ExpCM informed by the average of the H1 and H3 deep mutational scans. the ExpCM is the relative rate of fixation of nonsynonymous to synonymous mutations. this more realistic null model gives ExpCMs enhanced power to detect diversifying selection for amino-acid change. the models fit here are the same ones in Fig. 4. the tree\u2019s deepest branches are shortest when they are optimized by the GY94 model, which lacks both and site-specific amino-acid preferences. the tree\u2019s diameter is 159 per cent of the GY94 model tree diameter for ExpCMs informed by H1 or H3 amino-acid preferences. the tree diameter extension of ExpCM(H1+H3 avg)+ versus can be explained by simply adding the extension from incorporating (GY94+ versus GY94) to the extension from incorporating site-specific amino-acid preferences is not uniform across the tree. the increase in branch length is most pronounced on branches leading to the HA sequence that was used in the deep mutational scanning experiment. the ExpCM informed by the average of the H1 and H3 data has a more uniform effect across the tree. ExpCMs estimate longer branches, but that the effect is shaped by the set of amino-acid preferences used to inform the model. ExpCMs defined by amino-acid preferences from any of the deep mutational scanning experiments estimate generally longer branches than the GY94 model. the effect of a mutation at one site in a protein can depend on the amino-acid identities of other sites in the protein. this epistasis can lead to shifts in a protein\u2019s amino-acid preferences over evolutionary time. an ExpCM is expected to most accurately describe evolution of sequences closely related to the one used in the experiment. values of that are >1 indicate that natural selection prefers the same amino acids as the experiments but with a greater stringency. ExpCM stringency parameter is a measure of the congruence between natural selection and the experimental measurements. averaging the measurements across these two HAs is a heuristic method of accounting for shifts in preferences during HA evolution. if amino-acid preferences shift during evolution, there simply will not be any single set of time-homogeneous site-specific preferences that accurately describes evolution along the entirety of a phylogenetic tree that covers a wide span of sequences. the maximum-likelihood implementations of Tamuri, dos Reis, and goldstein (2012) and Tamuri, goldman, and dos Reis (2014) are designed for estimating the amino-acid preferences, not for phylogenetic inference. the model most comparable to our ExpCMs is the codon mutation-selection model implemented in PhyloBayes-MPI, which we will refer to as pbMutSel. the amino-acid preferences inferred by the pbMutSel model are quite similar to the (H1+ H3 avg) obtained by averaging the deep mutational scanning measurements for the H1 and H3 HAs. this strong correlation indicates that the ExpCM(H1+H3 avg)+ is unlikely to be much different than a pbMutSel model that is parameterized only using the natural sequence data. the individual re-scaled H1 and H3 deep mutational scanning preferences are to each other. points denote branch lengths between all pairs of tips on the tree. blue and orange denote branches that lead to the H1 and H3 deep mutational scanning reference sequences respectively. the 'tree average' preferences inferred by the pbMutSel model appear to be slightly better than the experimental values. ExpCM and pbMutSel models differ slightly in the extent to which they lengthen different branches. neither model can avoid tension between the local and global accuracy of amino-acid preferences. experimentally measured amino-acid preferences are most accurate for sequences similar to the one used in the experiment. averaging experimental measurements on two protein homologs does a somewhat better job of capturing the \u2018average\u2019 constraint across the tree. however, even these \u2018average\u2019 preferences exhibit a trade-off between local and global accuracy. the challenge is to overcome these shortcomings with models that are tractable for real phylogenetic questions. the Felsenstein pruning algorithm (Felsenstein 1981) is typically used to evaluate phylogenetic likelihoods breaks down when sites are no longer treated independently. y if A ( x ) = A ( y ) and x is converted to y by a single - nucleotide transversion, y if A ( x ) A ( y ) and x is converted to y by a single - nucleotide transversion, y if A ( x ) = A ( y ) and x is converted to y by a single - nucleotide experiments measure the preference r, a of every site r for every amino acid a. the experiments measure the preference r, a of every site r for every amino acid a. an ExpCM has five free parameters:, and the three independent x values. the amino-acid preferences are not free parameters since they are determined a priori by an experiment independent of the sequence alignment being analysed. the ExpCM+ model has twelve free parameters, and the ExpCM+ model has six free parameters. each site r has its own r value that is calculated from the amino-acid preferences. phydms_prepalignment removed sequences with ambiguous nucleotides, premature stops, or frameshift mutations. we subsampled the remaining sequences to five per subtype with 1 sequence per year per subtype. the \u2018low divergence\u2019 alignments had 59 % amino-acid identity to the sequence used in the deep mutational scanning. the \u2018intermediate divergence\u2019 alignments had 46 % identity from the reference sequence. we inferred the tree topology of each alignment using RAxML and the GTRCAT model. we simulated sequences using pyvolve (Spielman and Wilke 2015a) along the full HA tree using an ExpCM defined by parameters fit to the \u2018low divergence\u2019 H1 subtree. we performed 10 replicate simulations and estimated the branch lengths for each replicate using phydms_comprehensive. 4.1 Substitution models All of the substitution models used in this paper have been described previously. here we briefly recap their exact mathematical implementations. the \u2018corrected F3X4\u2019 method calculates the y values from these nucleotide frequencies but corrects for the exclusion of sequences with premature stop codons from the analysis. a GY94 model has eleven free parameters:, and the nine nucleotide frequency parameters used to define y. w is the nucleotide frequency of nucleotide w and is the transition-transversion rate. experiments measure the preference r, a of every site r for every amino acid a. 4.1.3 rate variation The GY94+ is equivalent to the M5 model in Yang et al. (2000) with drawn from K = 4 categories. ExpCM+ similarly draws from a distribution discretized into K = 4 bins. each bin is equally weighted and takes on the mean value of the bin. GY94 model The GY94 model is M0 variant of the Goldman-Yang model described by Yang et al. (2000). substitution rate Pxy from codon x to codon y is P x y = 0 if x and y differ by more than one nucleotide, y if A ( x ) = A ( y ) and x is converted to y by a single - nucleotide transversion the \u2018corrected F3X4\u2019 method calculates the y values from these nucleotide frequencies but corrects for the exclusion of sequences with premature stop codons from the analysis. a GY94 model has eleven free parameters:, and the nine nucleotide frequency parameters used to define y. the deep mutational scanning amino-acid preferences are incorporated into the ExpCM via the F r, x y terms. the experiments measure the preference r, a of every site r for every amino acid a. 4.1.3 rate variation The GY94+ is equivalent to the M5 model in Yang et al. (2000) with drawn from K = 4 categories. the ExpCM+ similarly draws from a distribution discretized into K = 4 bins. each bin is equally weighted and takes on the mean value of the bin. codons that are nonsynonymous to codon x differ from codon x by only one nucleotide. we used amino-acid preferences measured in deep mutational scans of the A/WSN/1933 H1 HA (Doud and Bloom 2016) and the A/Perth/2009 H3 HA (Lee et al. 2018) resulting alignment contains 92 sequences, and is provided in Supplementary file 4. 'low divergence' alignments had 59 % amino-acid identity to the sequence used in the deep mutational scanning. x ranges over all codons that encode amino-acid a, p r, x is the stationary state of the model at site r and codon x. x y is the value in row x and column y of the matrix obtained by exponentiating the product of t and the substitution matrix P r for site r. simulations For Fig. 3, we simulated sequences using pyvolve (Spielman and Wilke 2015a) along phydms normalized the branch lengths on the pbMutSel consensus tree and the ExpCM(H1+H3 avg)+ by dividing each branch by the length from A/South Carolina/1/1918 and A/Solomon Islands/3/2006. software versions and computer codes All codes used for the analyzes are available at https://github.com/jbloomlab/divergence_timing_manuscript. Supplementary Material Supplementary File 1 Click here for additional data file. (8.4KB, txt) Supplementary File 2 Click here for additional data file."}{"summary": "phylogenetic estimates of divergence times of many viral lineages are too recent. phylogenetic estimates of when major simian immunodeficiency virus groups diverged are almost 100 times more recent than the estimate based on geographic isolation of their host species. most phylogenetic models try to account for these constraints using relatively simple approaches such as allowing the rate of substitution to vary across sites according to some statistical distribution (Yang 1994; Yang et al. 2000). these models of purifying selection are usually inadequate (Duch\u00eane et al. 2015a; Duch\u00eane, Di Giallonardo, and Holmes 2015b) ExpCMs and other models of purifying selection estimate branch lengths on a phylogenetic tree of influenza virus hemagglutinin (HA) this extension of branch length is mostly independent and additive with that achieved by the more conventional approach of modeling rate variation. results 2.1 Different ways substitution models account for purifying selection. the gene-wide is usually 1 (Murrell et al. 2015) and crudely represents the fact that many amino-acid substitutions are under purifying selection. a single gene-wide ignores the fact that purifying selection is heterogeneous across sites. the most common strategy to ameliorate this defect is to allow to vary among sites according to some statistical distribution. substitution models can incorporate neither, one, or both of these features. mutation-selection models account for the fact that purifying selection depends idiosyncratically on the specific amino-acid mutation at each site in the protein. mutation-selection models must specify 19 parameters defining the amino-acid preferences for each site. this corresponds to 19 L parameters for a protein of length L, or 9,500 parameters for a 500-residue protein. the number of ExpCM free parameters is similar to a non-site-specific substitution model. a substitution model transforms sequence divergence into branch length. the transformation from sequence divergence to branch length is trivial when the sequence identity is high. a simple exponential model will correctly infer the short branch length of 1 / L substitutions per site. the GY94 model predicts the same behavior for all sites, since it does not have site-specific parameters. the predicted sequence identity is higher than 1 20 = 0.05 due to redundant codon and nucleotide biases favoring certain amino acids. but biochemically improbable that it would ever become as low as 0.062. GY94+ model takes longer to reach the asymptote than GY94. but the asymptote is identical for both models. the invariance of the asymptotic sequence identity under different schemes for modeling is a fundamental feature of this type of reversible substitution model. an ExpCM but not a GY94-style model predicts that the identity will always be relatively high. simulations demonstrate how failure to model site-specific amino-acid preferences leads to branch-length underestimation. we simulated alignments of sequences along the HA phylogenetic tree. we performed 10 simulations and inferences, and gray points show each inferred branch length from each simulation. black points show the average of each branch length across simulations. the GY94 model estimated branch lengths that are 60 per cent of the true values for the longest branches. HA consists of a number of different subtypes. sequences within a subtype have >68 per cent amino-acid identity. but sequences in different subtypes have as little as 38 per cent identity. the amino-acid preferences measured for these two HAs are shown in Supplementary Figs S1 and S2. the H1 and H3 HAs have only 42 per cent amino-acid identity. the ExpCMs always fit an greater than the GY94 model. the ExpCM+ models fit all four categories to values 1. the ExpCM is the relative rate of fixation of nonsynonymous to synonymous mutations. this more realistic null model gives ExpCMs enhanced power to detect diversifying selection for amino-acid change. all ExpCMs describe evolution of HA better than the GY94 models. models that account for purifying selection via either rate variation or site-specific amino-acid preferences do not just exhibit better fit. ExpCMs use amino-acid preferences measured in deep mutational scanning of an H1 HA (Doud and Bloom 2016), an H3 HA (Lee et al. 2018), or the average of the measurements for these two HAs. the root of each tree is placed where it would fall if the tree was midpoint rooted using the branch lengths inferred by RAxML using the GTRCAT model. the ExpCM informed by the H1 data most dramatically lengthens branches near the H1 clade of the tree. the ExpCM informed by the H3 data has the largest effect on branches near the H3 clade. ExpCMs estimate longer branches, but that the effect is shaped by the set of amino-acid preferences used to inform the model. an ExpCM leads to the most profound increase in branch length leading to the sequence used in the experiment. the effect of a mutation at one site in a protein can depend on the amino-acid identities of other sites in the protein. this can lead to shifts in a protein\u2019s amino-acid preferences over evolutionary time. ExpCM stringency parameter (ExpCM stringency parameter) is a measure of congruence between natural selection and the experimental measurements. values of that are >1 indicate that natural selection prefers the same amino acids as the experiments but with greater stringency. Fig. 6 shows that the amino-acid preferences clearly become less informative about natural selection as we move away from the experimental sequence on the tree. this shift of amino-acid preferences helps explain why the ExpCM informed by the average of the H1 and H3 experiments performs best. the maximum-likelihood implementations of Tamuri, dos Reis and goldstein are designed for estimating the amino-acid preferences, not for phylogenetic inference. the model most comparable to our ExpCMs is the codon mutation-selection model implemented in PhyloBayes-MPI, which we will refer to as pbMutSel. pbMutSel models fit a pbMutSel model to the entire HA tree. we compared the results to those from analyzing the same tree with the best ExpCM. the pbMutSel model also draws from a gamma-distribution. the ExpCM amino-acid preferences are experimentally measured and then rescaled by the stringency parameter in Table 1. the pbMutSel preferences are more correlated with the re-scaled average of the H1 and H3 deep mutational scanning preferences are to each other. the phydms program implementing ExpCMs and the PhyloBayes-MPI program implementing pbMutSel models estimated similar branch lengths the 'tree average' amino-acid preferences inferred by the pbMutSel model appear to be slightly better than the experimental values. the 'tree average' preferences inferred by the pbMutSel model appear to be slightly better than the experimental values. a single gene-wide ignores the fact that purifying selection is heterogeneous across sites. the most common strategy to ameliorate this defect is to allow to vary among sites according to some statistical distribution. a GY94+ captures the fact that the rate of nonsynonymous substitution can vary across sites. mutation-selection models account for the fact that purifying selection depends idiosyncratically on the specific amino-acid mutation at each site in the protein. these models explicitly define a different set of amino-acid preferences at each site in the protein. mutation-selection models must specify 19 parameters defining the amino-acid preferences for each site. this corresponds to 19 L parameters for a protein of length L, or 9,500 parameters for a 500-residue protein. it is challenging to obtain values for these amino-acid preference parameters in a maximum-likelihood framework without overfitting the data. a substitution model transforms sequence divergence into branch length. the transformation from sequence divergence to branch length is trivial when the sequence identity is high. if there has only been one substitution, then the sequence identity will simply be ( L 1 ) / L for a gene of L sites. 0.05 due to redundant codon and nucleotide biases favoring certain amino acids. it seems biochemically improbable that it would ever become as low as 0.062. Fig. 2 shows that the GY94+ model takes longer to reach the asymptote than GY94, but that the asymptote is identical for both models. this fact holds true even if we use experimental measurements of HA\u2019s site-specific amino-acid preferences to calculate a different r value for each site. simulations demonstrate how failure to model site-specific amino-acid preferences leads to branch-length underestimation. we simulated alignments of sequences along the HA phylogenetic tree using an ExpCM parameterized by the amino-acid preferences of an H1 HA. inferred branch lengths exactly matched those used in the simulations. the GY94 model estimated branch lengths that are 60 per cent of the true values for the longest branches. there was no systematic underestimation of long branches by the ExpCM and ExpCM+ models. a subtype have >68 per cent amino-acid identity, but sequences in different subtypes have as little as 38 per cent identity. HA proteins from all subtypes have a highly conserved structure that performs a highly conserved function. we used RAxML with a nucleotide substitution model (GTRCAT) to infer a tree for 92 HA sequences drawn from 15 of the 18 subtypes. three sets of HA amino-acid preferences define three different ExpCMs. the best fit was for the ExpCM informed by the average of the H1 and H3 deep mutational scans. the best fit was for the ExpCM informed by the average of the H1 and H3 deep mutational scans. the ExpCM is the relative rate of fixation of nonsynonymous to synonymous mutations. this more realistic null model gives ExpCMs enhanced power to detect diversifying selection for amino-acid change. the models fit here are the same ones in Fig. 4. the tree\u2019s deepest branches are shortest when they are optimized by the GY94 model, which lacks both and site-specific amino-acid preferences. the tree\u2019s diameter is 159 per cent of the GY94 model tree diameter for ExpCMs informed by H1 or H3 amino-acid preferences. the tree diameter extension of ExpCM(H1+H3 avg)+ versus can be explained by simply adding the extension from incorporating (GY94+ versus GY94) to the extension from incorporating site-specific amino-acid preferences is not uniform across the tree. the increase in branch length is most pronounced on branches leading to the HA sequence that was used in the deep mutational scanning experiment. the ExpCM informed by the average of the H1 and H3 data has a more uniform effect across the tree. ExpCMs estimate longer branches, but that the effect is shaped by the set of amino-acid preferences used to inform the model. ExpCMs defined by amino-acid preferences from any of the deep mutational scanning experiments estimate generally longer branches than the GY94 model. the effect of a mutation at one site in a protein can depend on the amino-acid identities of other sites in the protein. this epistasis can lead to shifts in a protein\u2019s amino-acid preferences over evolutionary time. an ExpCM is expected to most accurately describe evolution of sequences closely related to the one used in the experiment. values of that are >1 indicate that natural selection prefers the same amino acids as the experiments but with a greater stringency. ExpCM stringency parameter is a measure of the congruence between natural selection and the experimental measurements. averaging the measurements across these two HAs is a heuristic method of accounting for shifts in preferences during HA evolution. if amino-acid preferences shift during evolution, there simply will not be any single set of time-homogeneous site-specific preferences that accurately describes evolution along the entirety of a phylogenetic tree that covers a wide span of sequences. the maximum-likelihood implementations of Tamuri, dos Reis, and goldstein (2012) and Tamuri, goldman, and dos Reis (2014) are designed for estimating the amino-acid preferences, not for phylogenetic inference. the model most comparable to our ExpCMs is the codon mutation-selection model implemented in PhyloBayes-MPI, which we will refer to as pbMutSel. the amino-acid preferences inferred by the pbMutSel model are quite similar to the (H1+ H3 avg) obtained by averaging the deep mutational scanning measurements for the H1 and H3 HAs. this strong correlation indicates that the ExpCM(H1+H3 avg)+ is unlikely to be much different than a pbMutSel model that is parameterized only using the natural sequence data. the individual re-scaled H1 and H3 deep mutational scanning preferences are to each other. points denote branch lengths between all pairs of tips on the tree. blue and orange denote branches that lead to the H1 and H3 deep mutational scanning reference sequences respectively. the 'tree average' preferences inferred by the pbMutSel model appear to be slightly better than the experimental values. ExpCM and pbMutSel models differ slightly in the extent to which they lengthen different branches. neither model can avoid tension between the local and global accuracy of amino-acid preferences. experimentally measured amino-acid preferences are most accurate for sequences similar to the one used in the experiment. averaging experimental measurements on two protein homologs does a somewhat better job of capturing the \u2018average\u2019 constraint across the tree. however, even these \u2018average\u2019 preferences exhibit a trade-off between local and global accuracy. the challenge is to overcome these shortcomings with models that are tractable for real phylogenetic questions. the Felsenstein pruning algorithm (Felsenstein 1981) is typically used to evaluate phylogenetic likelihoods breaks down when sites are no longer treated independently. y if A ( x ) = A ( y ) and x is converted to y by a single - nucleotide transversion, y if A ( x ) A ( y ) and x is converted to y by a single - nucleotide transversion, y if A ( x ) = A ( y ) and x is converted to y by a single - nucleotide experiments measure the preference r, a of every site r for every amino acid a. the experiments measure the preference r, a of every site r for every amino acid a. an ExpCM has five free parameters:, and the three independent x values. the amino-acid preferences are not free parameters since they are determined a priori by an experiment independent of the sequence alignment being analysed. the ExpCM+ model has twelve free parameters, and the ExpCM+ model has six free parameters. each site r has its own r value that is calculated from the amino-acid preferences. phydms_prepalignment removed sequences with ambiguous nucleotides, premature stops, or frameshift mutations. we subsampled the remaining sequences to five per subtype with 1 sequence per year per subtype. the \u2018low divergence\u2019 alignments had 59 % amino-acid identity to the sequence used in the deep mutational scanning. the \u2018intermediate divergence\u2019 alignments had 46 % identity from the reference sequence. we inferred the tree topology of each alignment using RAxML and the GTRCAT model. we simulated sequences using pyvolve (Spielman and Wilke 2015a) along the full HA tree using an ExpCM defined by parameters fit to the \u2018low divergence\u2019 H1 subtree. we performed 10 replicate simulations and estimated the branch lengths for each replicate using phydms_comprehensive. 4.1 Substitution models All of the substitution models used in this paper have been described previously. here we briefly recap their exact mathematical implementations. the \u2018corrected F3X4\u2019 method calculates the y values from these nucleotide frequencies but corrects for the exclusion of sequences with premature stop codons from the analysis. a GY94 model has eleven free parameters:, and the nine nucleotide frequency parameters used to define y. w is the nucleotide frequency of nucleotide w and is the transition-transversion rate. experiments measure the preference r, a of every site r for every amino acid a. 4.1.3 rate variation The GY94+ is equivalent to the M5 model in Yang et al. (2000) with drawn from K = 4 categories. ExpCM+ similarly draws from a distribution discretized into K = 4 bins. each bin is equally weighted and takes on the mean value of the bin. GY94 model The GY94 model is M0 variant of the Goldman-Yang model described by Yang et al. (2000). substitution rate Pxy from codon x to codon y is P x y = 0 if x and y differ by more than one nucleotide, y if A ( x ) = A ( y ) and x is converted to y by a single - nucleotide transversion the \u2018corrected F3X4\u2019 method calculates the y values from these nucleotide frequencies but corrects for the exclusion of sequences with premature stop codons from the analysis. a GY94 model has eleven free parameters:, and the nine nucleotide frequency parameters used to define y. the deep mutational scanning amino-acid preferences are incorporated into the ExpCM via the F r, x y terms. the experiments measure the preference r, a of every site r for every amino acid a. 4.1.3 rate variation The GY94+ is equivalent to the M5 model in Yang et al. (2000) with drawn from K = 4 categories. the ExpCM+ similarly draws from a distribution discretized into K = 4 bins. each bin is equally weighted and takes on the mean value of the bin. codons that are nonsynonymous to codon x differ from codon x by only one nucleotide. we used amino-acid preferences measured in deep mutational scans of the A/WSN/1933 H1 HA (Doud and Bloom 2016) and the A/Perth/2009 H3 HA (Lee et al. 2018) resulting alignment contains 92 sequences, and is provided in Supplementary file 4. 'low divergence' alignments had 59 % amino-acid identity to the sequence used in the deep mutational scanning. x ranges over all codons that encode amino-acid a, p r, x is the stationary state of the model at site r and codon x. x y is the value in row x and column y of the matrix obtained by exponentiating the product of t and the substitution matrix P r for site r. simulations For Fig. 3, we simulated sequences using pyvolve (Spielman and Wilke 2015a) along phydms normalized the branch lengths on the pbMutSel consensus tree and the ExpCM(H1+H3 avg)+ by dividing each branch by the length from A/South Carolina/1/1918 and A/Solomon Islands/3/2006. software versions and computer codes All codes used for the analyzes are available at https://github.com/jbloomlab/divergence_timing_manuscript. Supplementary Material Supplementary File 1 Click here for additional data file. (8.4KB, txt) Supplementary File 2 Click here for additional data file."}